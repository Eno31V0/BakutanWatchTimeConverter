<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>外部JSON参照オフセット時刻計算</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        select, input { margin: 10px; padding: 5px; }
        h3 { margin-top: 20px; }
    </style>
</head>
<body>

    <h2>外部JSON参照オフセット時刻計算</h2>

    <label for="offsetSelect">プリセットオフセット:</label>
    <select id="offsetSelect">
        <option value="preset1">プリセット 1</option>
        <option value="preset2">プリセット 2</option>
        <option value="preset3">プリセット 3</option>
        <option value="preset4">プリセット 4</option>
    </select>

    <br>

    <label for="extraOffset">追加オフセット (秒):</label>
    <input type="number" id="extraOffset" value="0" min="0">

    <br>

    <label for="playTime">再生時刻 (hh:mm:ss):</label>
    <input type="time" id="playTime" step="1" value="00:00:00">

    <h3>結果: <span id="result">--:--:--</span></h3>

    <script>
        const jsonUrl = "https://raw.githubusercontent.com/Eno31v0/WebPageLearn/main/offsets.json";
        let offsets = {};  // JSONデータを保存する変数

        // JSONデータを取得
        async function fetchOffsets() {
            try {
                const response = await fetch(jsonUrl);
                if (!response.ok) throw new Error("JSONの取得に失敗");
                offsets = await response.json();
                calculateTime();  // データ取得後に計算を実行
            } catch (error) {
                console.error("JSON読み込みエラー:", error);
            }
        }

        function calculateTime() {
            let presetKey = document.getElementById("offsetSelect").value;
            let presetOffset = offsets[presetKey] || 0;  // JSONデータの値を取得
            let extraOffset = parseInt(document.getElementById("extraOffset").value) || 0;
            let totalOffset = presetOffset + extraOffset;

            let playTimeStr = document.getElementById("playTime").value;

            if (!playTimeStr) {
                document.getElementById("result").textContent = "--:--:--";
                return;
            }

            let [hours, minutes, seconds] = playTimeStr.split(":").map(Number);
            let playTimeInSeconds = hours * 3600 + minutes * 60 + seconds;
            let adjustedTimeInSeconds = playTimeInSeconds - totalOffset;

            if (adjustedTimeInSeconds < 0) {
                document.getElementById("result").textContent = "00:00:00";
                return;
            }

            let adjustedHours = Math.floor(adjustedTimeInSeconds / 3600);
            let adjustedMinutes = Math.floor((adjustedTimeInSeconds % 3600) / 60);
            let adjustedSeconds = adjustedTimeInSeconds % 60;

            document.getElementById("result").textContent = 
                `${String(adjustedHours).padStart(2, '0')}:${String(adjustedMinutes).padStart(2, '0')}:${String(adjustedSeconds).padStart(2, '0')}`;
        }

        // イベントリスナーの登録
        document.getElementById("offsetSelect").addEventListener("change", calculateTime);
        document.getElementById("extraOffset").addEventListener("input", calculateTime);
        document.getElementById("playTime").addEventListener("input", calculateTime);

        // JSONデータの取得を開始
        fetchOffsets();
    </script>

</body>
</html>
