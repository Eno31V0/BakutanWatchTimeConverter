<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>外部JSON参照オフセット時刻計算</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }

        select,
        input,
        button {
            margin: 10px;
            padding: 5px;
        }

        h3 {
            margin-top: 20px;
        }
    </style>
</head>

<body>

    <h2>外部JSON参照オフセット時刻計算</h2>

    <label for="offsetSelect">プリセットオフセット:</label>
    <select id="offsetSelect"></select> <!-- JSONから動的に選択肢を追加 -->

    <br>

    <label for="extraOffset">追加オフセット (秒):</label>
    <input type="number" id="extraOffset" value="0" min="0">

    <br>

    <label for="playTime">再生時刻 (hh:mm:ss):</label>
    <input type="time" id="playTime" step="1" value="00:00:00">

    <h3>結果: <span id="result">--:--:--</span></h3>

    <!-- ボタンとラベル -->
    <br>
    <button onclick="window.location.href='https://example.com'">特定URLへ移動</button>
    <p>問い合わせ等はこちら</p>

    <script>
        const jsonUrl = "https://raw.githubusercontent.com/Eno31v0/WebPageLearn/main/offsets.json";
        let offsets = {};

        async function fetchOffsets() {
            try {
                const response = await fetch(jsonUrl);
                if (!response.ok) throw new Error("JSONの取得に失敗");
                offsets = await response.json();

                // JSONデータを元に選択肢を動的に作成
                let selectElement = document.getElementById("offsetSelect");
                selectElement.innerHTML = "";  // 既存の選択肢をクリア
                offsets.presets.forEach(preset => {
                    let option = document.createElement("option");
                    option.value = preset.id;
                    option.textContent = preset.name;
                    selectElement.appendChild(option);
                });

                calculateTime();
            } catch (error) {
                console.error("JSON読み込みエラー:", error);
            }
        }

        function calculateTime() {
            let presetId = document.getElementById("offsetSelect").value;
            let preset = offsets.presets.find(p => p.id === presetId);
            if (!preset) return;

            let playTimeStr = document.getElementById("playTime").value;

            if (!playTimeStr) {
                document.getElementById("result").textContent = "--:--:--";
                return;
            }

            let [hours, minutes, seconds] = playTimeStr.split(":").map(Number);
            let playTimeInSeconds = hours * 3600 + minutes * 60 + seconds;

            // 追加オフセットを取得
            let extraOffset = parseInt(document.getElementById("extraOffset").value) || 0;

            // 基本オフセットを適用
            let offsetToApply = preset.offset;

            // 複数の時刻を超えた場合に新しいオフセットを適用
            if (preset.timeOffsets && preset.timeOffsets.length > 0) {
                for (let timeOffset of preset.timeOffsets) {
                    let [switchHours, switchMinutes, switchSeconds] = timeOffset.switchTime.split(":").map(Number);
                    let switchTimeInSeconds = switchHours * 3600 + switchMinutes * 60 + switchSeconds;

                    if (playTimeInSeconds >= switchTimeInSeconds) {
                        offsetToApply = timeOffset.newOffset;
                    }
                }
            }

            let totalOffset = offsetToApply + extraOffset;
            let adjustedTimeInSeconds = playTimeInSeconds - totalOffset;

            if (adjustedTimeInSeconds < 0) {
                document.getElementById("result").textContent = "00:00:00";
                return;
            }

            let adjustedHours = Math.floor(adjustedTimeInSeconds / 3600);
            let adjustedMinutes = Math.floor((adjustedTimeInSeconds % 3600) / 60);
            let adjustedSeconds = adjustedTimeInSeconds % 60;

            document.getElementById("result").textContent =
                `${String(adjustedHours).padStart(2, '0')}:${String(adjustedMinutes).padStart(2, '0')}:${String(adjustedSeconds).padStart(2, '0')}`;
        }

        document.getElementById("offsetSelect").addEventListener("change", calculateTime);
        document.getElementById("extraOffset").addEventListener("input", calculateTime);
        document.getElementById("playTime").addEventListener("input", calculateTime);

        fetchOffsets();

    </script>

</body>

</html>